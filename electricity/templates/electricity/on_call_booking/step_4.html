{% extends "electricity/on_call_booking/base.html" %}
{% load i18n %}
{% block booking_content %}
<form method="post" class="on-call-form">
  {% csrf_token %}

  {% if submitted %}
    <div class="success-banner">
      <strong>{% trans "Application received." %}</strong>
      {% trans "Your on-call registration has been submitted. Reference ID:" %} {{ booking_id }}.
    </div>
  {% endif %}

  <div class="oncall-header">
    <div class="section-label">{% trans "Finalize Registration" %}</div>
    <div class="section-title">{% trans "Finalize Your Registration" %}</div>
    <p>{% trans "Review and complete the last few steps to activate your on-call electrical service." %}</p>
  </div>

  <div class="form-card">
    <div class="form-card-title">{% trans "Current electrical situation" %}</div>

    <label>{% trans "When was your last electrical issue?" %}</label>
    <input class="form-control" type="date" name="last_issue_date" value="{{ data.last_issue_date|default:'' }}">

    <div class="toggle-row compact">
      <div>
        <strong>{% trans "Are you currently with another provider?" %}</strong>
        <p>{% trans "Active contract elsewhere" %}</p>
      </div>
      <label class="switch">
        <input type="checkbox" name="active_contract" {% if data.active_contract %}checked{% endif %}>
        <span class="slider"></span>
      </label>
    </div>

    <label>{% trans "Briefly describe any recurring electrical issues" %}</label>
    <textarea class="form-control"
              name="recurring_issues"
              rows="4"
              placeholder="{% trans 'e.g., Occasional flickering in the main hall...' %}">
      {{ data.recurring_issues|default:'' }}
    </textarea>
  </div>

  <div class="form-card">
    <div class="form-card-title">{% trans "Additional notes (Optional)" %}</div>
    <textarea class="form-control"
              name="additional_notes"
              rows="4"
              placeholder="{% trans 'Enter any additional details here...' %}">
      {{ data.additional_notes|default:'' }}
    </textarea>
  </div>

  <div class="form-card">
    <div class="form-card-title">{% trans "Emergency pricing estimate" %}</div>

    <label>{% trans "Estimated emergency hours" %}</label>
    <input class="form-control"
           type="number"
           min="1"
           name="emergency_hours"
           value="{{ data.emergency_hours|default:'1' }}">

    <div class="summary-note">
      {% trans "Estimated total:" %}
      <strong>{{ emergency_estimated_total|default:"0" }} {{ currency|default:"SEK" }}</strong>
      ({{ hourly_rate_emergency|default:"0" }} {{ currency|default:"SEK" }}/{% trans "hr" %})
    </div>
  </div>

  <div class="form-card review-card">
    <div class="form-card-title">{% trans "Review & Submit" %}</div>

    {% trans "On-Call Pro (Monthly)" as default_service_plan %}
    <div class="review-row">
      <span>{% trans "Service Plan" %}</span>
      <strong>{{ data.service_plan|default:default_service_plan }}</strong>
    </div>

    {% trans "123 Industrial Way" as default_address %}
    {% trans "Stockholm" as default_city %}
    <div class="review-row">
      <span>{% trans "Site Address" %}</span>
      <strong>{{ data.company_address|default:default_address }}, {{ data.city|default:default_city }}</strong>
    </div>

    <div class="notice">
      {% trans "Notice of Activation: By clicking \"Submit Application\", you acknowledge that your service agreement will be activated immediately upon verification. A site inspection will be scheduled within 48 hours." %}
    </div>

    <div class="review-actions">
      <a class="btn btn-light"
         href="{% url 'electricity:on_call_booking_step' 3 %}">
         {% trans "Back" %}
      </a>

      <button class="btn btn-primary" type="submit">
        {% trans "Submit Application" %}
      </button>
    </div>
  </div>

</form>
{% endblock %}
